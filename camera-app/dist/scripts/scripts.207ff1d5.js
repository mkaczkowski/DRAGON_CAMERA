"use strict";var sioWebApp=angular.module("sioWebApp",["underscore","ionic","hmTouchEvents","ngCordova.plugins.camera","ngCordova.plugins.dialogs","ngCordova.plugins.network","ngCordova.plugins.socialSharing","sioWebApp.config","sioWebApp.mock","sioWebApp.common","sioWebApp.navigation","sioWebApp.home"]);sioWebApp.config(["loggerProvider",function(a){a.enabled(!0)}]),sioWebApp.controller("AppCtrl",["$scope","networkService","configuration",function(a,b,c){a.rateUs=function(){b.openMarketURL(c.marketUrl)},a.rateUs2=function(){b.openMarketURL2(c.marketUrl)},a.rateUs3=function(){b.openMarketURL3(c.marketUrl)}}]),sioWebApp.run(["$rootScope","configuration",function(a,b){a.app=b}]),angular.module("sioWebApp.config",[]).constant("configuration",{name:"Dragon Camera",barStyle:"bar-energized",version:"1.0.0",marketUrl:"com.dragon.camera2",isProd:JSON.parse("true")}),angular.module("sioWebApp.home",[]),angular.module("sioWebApp.home").controller("HomeCtrl",["$scope","$ionicPopup","$ionicLoading","$timeout","imageService","cameraService","mySharedService","sharingService","notificationService","networkService","configuration",function(a,b,c,d,e,f,g,h,i){var j,k=function(){j=c.show({content:"Processing..."})},l=function(){j&&j.hide()};a.isEmpty=!0,a.isSelected=!1,a.isExpanded=!0,a.$on("handleBroadcast",function(){a.isSelected=g.message,g.message&&(a.isEmpty=!1)}),a.resetElement=function(){console.log("resetElement"),g.resetElement()},a.removeElement=function(){console.log("remove Element"),g.removeElement(),a.isEmpty=0==angular.element(".drag-and-drop").length},a.moveUp=function(){g.moveUp()},a.moveDown=function(){g.moveDown()},a.mirror=function(){g.mirror()},a.hideToolbar=function(){a.isExpanded=!1},a.showToolbar=function(){a.isExpanded=!0},a.saveCanvasToFile=function(b){k(),g.prepForBroadcast(null),d(function(){html2canvas([document.getElementById("canvas")],{onrendered:function(c){e.saveCanvasToFile(c,function(c){l(),b?b(c):i.savedConfirm(c,function(b){a.sharePicure(b)})},function(a){l(),console.log("saveCanvasToFile err:"+a),i.showError("Ooops. Something went wrong.")})}})},500)},a.sharePicure=function(){a.saveCanvasToFile(function(a){h.shareViaFacebook(a)})},a.getPicture=function(){f.takePicture("pictureContainer")},a.clearWhiteboard=function(){i.confirm("Are you sure you want to clear?",function(){g.clearAll(),a.isEmpty=!0})},a.loadImage=function(){f.loadImageFromLibrary("pictureContainer")},g.init(),i.showInitPopup(a.getPicture,a.loadImage)}]),angular.module("sioWebApp.navigation",["sioWebApp.config"]),angular.module("sioWebApp.navigation").controller("NavigationCtrl",["$scope","$location",function(a,b){a.menuItems=[{name:"Home",path:"home"},{name:"Contact",path:"contact"}],a.isActive=function(a){return b.path().substr(0,a.length)==a}}]),angular.module("sioWebApp.common",[]),angular.module("sioWebApp.common").directive("debug",["$compile",function(a){return{terminal:!0,priority:1e6,link:function(b,c){var d=c.clone();c.attr("style","color:red"),d.removeAttr("debug");var e=a(d)(b);c.after(e)}}}]);var mySharedService=angular.module("sioWebApp.common").factory("mySharedService",["$rootScope",function(a){function b(a,b,d){var e;switch(a.type){case"touch":break;case"drag":d.posX=a.gesture.deltaX+d.lastPosX,d.posY=a.gesture.deltaY+d.lastPosY,e="translate("+d.posX+"px,"+d.posY+"px)",e+="rotate("+d.last_rotation+"deg) ",e+="scale("+(d.isMirror?-d.last_scale:d.last_scale)+","+d.last_scale+")";break;case"transform":d.rotation=d.last_rotation+a.gesture.rotation,d.scale=Math.max(.4,Math.min(d.last_scale*a.gesture.scale,5)),e="translate("+d.lastPosX+"px,"+d.lastPosY+"px) ",e+="rotate("+d.rotation+"deg) ",e+="scale("+(d.isMirror?-d.scale:d.scale)+","+d.scale+")";break;case"transformend":d.last_scale=d.scale,d.last_rotation=d.rotation;break;case"dragend":d.lastPosX=d.posX,d.lastPosY=d.posY}c.applyTransform(b,e)}var c={},d={},e={posX:0,posY:0,lastPosX:0,lastPosY:0,bufferX:0,bufferY:0,scale:1,last_scale:1,rotation:0,last_rotation:0,dragReady:0,isMirror:!1},f={},g={};return c.init=function(){var a={transform_always_block:!0,transform_min_scale:1,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0};angular.element("#draggableContainer").hammer(a).on("touch drag dragend transform transformend",function(a){if(angular.element(a.target).is("button"))return!0;if(a.gesture){if(a.gesture.preventDefault(),"draggableContainer"==a.gesture.target.id)return void c.prepForBroadcast(null);"touch"==a.type&&(c.currentElement=a.gesture.target,c.currentElementData=c.getElement(angular.element(c.currentElement).attr("data-id"))),b(a,c.currentElement,c.currentElementData)}})},c.applyTransform=function(a,b){console.info("trans:"+b),b&&(a.style.transform=b,a.style.oTransform=b,a.style.msTransform=b,a.style.mozTransform=b,a.style.webkitTransform=b)},c.addElement=function(a,b){function f(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}a.css({top:b.top,left:b.left}),a.attr("data-id",f());var g=a.get(0),h=JSON.parse(JSON.stringify(e));d[a.attr("data-id")]=h,c.currentElement=g,c.currentElementData=h},c.getElement=function(a){return d[a]},c.prepForBroadcast=function(a){this.message=a,this.broadcastItem()},c.broadcastItem=function(){a.$broadcast("handleBroadcast")},c.moveUp=function(){a.$broadcast("moveUp")},c.moveDown=function(){a.$broadcast("moveDown")},c.mirror=function(){c.currentElementData.isMirror=!c.currentElementData.isMirror;var a="translate("+c.currentElementData.lastPosX+"px,"+c.currentElementData.lastPosY+"px) ";a+="rotate("+c.currentElementData.last_rotation+"deg) ",a+="scale("+(c.currentElementData.isMirror?-c.currentElementData.last_scale:c.currentElementData.last_scale)+","+c.currentElementData.last_scale+")",c.applyTransform(c.currentElement,a)},c.removeElement=function(){a.$broadcast("removeElement"),this.prepForBroadcast(null)},c.clearAll=function(){a.$broadcast("clearAll"),this.prepForBroadcast(null)},c.resetElement=function(){c.currentElementData=JSON.parse(JSON.stringify(c.elementData)),d[f.className]=g;var a="translate("+c.currentElementData.lastPosX+"px,"+c.currentElementData.lastPosY+"px) ";a+="rotate("+c.currentElementData.rotation+"deg) ",a+="scale("+c.currentElementData.scale+","+c.currentElementData.scale+")",c.applyTransform(c.currentElement,a)},c.message,c}]);angular.module("sioWebApp.common").directive("draggableItem",["mySharedService",function(a){return{restrict:"E",template:'<img class="drag-and-drop" data-ng-src="{{src}}" style="padding: 8px;max-height: 100%;max-width: 100%;position: absolute;z-index: 1">',replace:!0,piority:1e4,scope:{src:"@",top:"@",left:"@"},controller:["$scope","$element","mySharedService",function(a,b,c){a.isSelected=!0,c.prepForBroadcast(b),a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)}}],link:function(b,c){a.addElement(c,b),b.$on("handleBroadcast",function(){var e=a.message==c,f=e!=b.isSelected;b.isSelected=e,b.safeApply(),f&&d()}),b.$on("removeElement",function(){b.isSelected&&c.remove()}),b.$on("moveUp",function(){if(b.isSelected){var a=parseInt(c.css("zIndex"));console.log(a),c.css("zIndex",a+1)}}),b.$on("moveDown",function(){if(b.isSelected){var a=parseInt(c.css("zIndex"));if(console.log(a),0==a)return;c.css("zIndex",a-1)}}),b.$on("clearAll",function(){c.remove()});var d=function(){var a=c;b.isSelected?a.addClass("selectedDraggable").css("border","3px dashed rgba(84, 85, 101, 1)"):a.removeClass("selectedDraggable").css("border","3px dashed rgba(84, 85, 101, 0)")};d(),c.bind("click touchstart",function(){a.prepForBroadcast(c)}),c.on("$destroy",function(){})}}}]),angular.module("sioWebApp.common").directive("carousel",["$compile",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="myCarousel" style="width: 100%;" ng-transclude></div>',link:function(b,c){function d(a){var b="";for(var d in a.items){var f=a.items[d].width,g=a.items[d].height,h=a.items[d].img,i=".png",j=h+i;b+="<div class='item item-light' style='padding: 7px; height: 69px;line-height: 69px;text-align: center;'><img class='thumb-img' style='max-width: 100%; max-height: 100%;' data-width='"+f+"' data-height='"+g+"' src='"+j+"' ></div>"}c.html(b),e()}function e(){angular.element(".thumb-img").bind("click",function(c){var d=angular.element(c.target),e=parseInt(d.attr("data-width")),f=parseInt(d.attr("data-height")),g=d.attr("src"),h=angular.element(document.getElementById("draggableContainer")),i=(h.height()-f-56)/2,j=(h.width()-e)/2,k=a('<draggable-item id="1" src="'+g+'" top="'+i+'px" left="'+j+'px"/>')(b);h.append(k)})}c.owlCarousel({jsonPath:"data/data.json",jsonSuccess:d,singleItem:!1,lazyLoad:!0,navigation:!0,pagination:!1,items:4})}}}]),angular.module("sioWebApp.common").provider("logger",[function(){var a=!0;this.enabled=function(b){a=!!b},this.$get=["$log",function(b){var c=function(a){this.context=a};return c.getInstance=function(a){return new c(a)},c.supplant=function(a,b){return a.replace(/\{([^{}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a})},c.getFormattedTimestamp=function(a){return c.supplant("{0}:{1}:{2}:{3}",[a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()])},c.prototype={_log:function(d,e){if(a){var f=c.getFormattedTimestamp(new Date),g="",h=[];switch(e.length){case 1:g=c.supplant("{0} - {1}: {2}",[f,this.context,e[0]]);break;case 3:h=e[2],g=c.supplant("{0} - {1}::{2}('{3}')",[f,this.context,e[0],e[1]]);break;case 2:"string"==typeof e[1]?g=c.supplant("{0} - {1}::{2}('{3}')",[f,this.context,e[0],e[1]]):(h=e[1],g=c.supplant("{0} - {1}: {2}",[f,this.context,e[0]]))}b[d].call(null,c.supplant(g,h))}},log:function(){this._log("log",arguments)},info:function(){this._log("info",arguments)},warn:function(){this._log("warn",arguments)},debug:function(){this._log("debug",arguments)},error:function(){this._log("error",arguments)}},c}]}]),angular.module("sioWebApp.common").controller("FileCtrl",["$scope","$cordovaFile",function(a,b){a.api=function(){b.checkDir(directory).then(function(){},function(){}),b.createDir(directory,!1).then(function(){},function(){}),b.checkFile(directory,file).then(function(){},function(){}),b.createFile(directory,file,!0).then(function(){},function(){}),b.removeFile(directory,file).then(function(){},function(){}),b.writeFile(directory,file).then(function(){},function(){}),b.readFile(directory,file).then(function(){},function(){}),b.downloadFile(source,filePath,!0,options).then(function(){},function(){}),b.uploadFile(server,filePath,options).then(function(){},function(){})}}]),angular.module("sioWebApp.common").factory("networkService",["$cordovaNetwork",function(a){var b={};return b.isOnline=function(){return a.isOnline()},b.openMarketURL=function(a){cordova.market.open(a)},b.openMarketURL2=function(a){window.plugins.market.open(a)},b.openMarketURL3=function(a){navigator.market.open(a)},b}]),angular.module("sioWebApp.common").factory("imageService",function(){var a={};return a.saveCanvasToFile=function(a,b,c){return window.canvas2ImagePlugin?void window.canvas2ImagePlugin.saveImageDataToLibrary(b,c,a):void c()},a.setWallpaper=function(a,b,c){var d="christmas",e="PluginImages";a="www/img/christmas.jpeg",wallpaper.setImage(a,d,e,b,c)},a}),angular.module("sioWebApp.common").factory("notificationService",["$cordovaDialogs","$ionicPopup","$timeout",function(a,b){var c={};return c.showError=function(a){var c=b.alert({title:a,okType:"button-assertive"});c.then(function(){console.log("showAlert closed.")})},c.showInfo=function(a){var c=b.alert({title:a,okType:"button-energized"});c.then(function(){console.log("showAlert closed.")})},c.savedConfirm=function(a,c){return b.showPopup({title:"Picture has beed saved!\npath",content:"",buttons:[{text:"Share",type:"button-positive",onTap:function(){return c(a),!0}},{text:"OK",type:"button-energized",onTap:function(){return!0}}]})},c.confirm=function(a,c){return b.showPopup({title:a,content:"",buttons:[{text:"Cancel",type:"button-default",onTap:function(){return!0}},{text:"OK",type:"button-energized",onTap:function(){return c(),!0}}]})},c.showInitPopup=function(a,c){var d=b.show({title:"Welcome!",subTitle:"Please take a picture or choose from gallery",scope:null,buttons:[{text:"Camera",type:"button-energized",onTap:function(){return a(),!0}},{text:"Gallery",type:"button-energized",onTap:function(){return c(),!0}}]});d.then(function(){console.log("showAlert closed.")})},c}]),angular.module("sioWebApp.common").factory("cameraService",["$cordovaCamera","notificationService",function(a,b){var c={};return c.takePhotoOptions={quality:100,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!1,correctOrientation:!0},c.loadImageOptions={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM},c.getPicture=function(d){var e=angular.element("#canvas");c.takePhotoOptions.targetWidth=e.width(),c.takePhotoOptions.targetHeight=e.height(),a.getPicture(c.takePhotoOptions).then(function(a){console.log("cameraService.getPicture2 success:"+a);var b=document.getElementById(d);b.src="data:image/jpeg;base64,"+a},function(a){console.error("error!!:"+a),b.showError("Ooops. Something went wrong.")})},c.loadImageFromLibrary=function(d){var e=angular.element("#canvas");c.loadImageOptions.targetWidth=e.width(),c.loadImageOptions.targetHeight=e.height(),a.getPicture(c.loadImageOptions).then(function(a){console.info("loadImageFromLibrary imageURI:"+a);var b=document.getElementById(d);b.style.display="block",b.src=a},function(a){console.error("error!!:"+a),b.showError("Ooops. Something went wrong.")})},c}]),angular.module("sioWebApp.common").factory("sharingService",["configuration","$cordovaSocialSharing","notificationService",function(a,b,c){var d={};return d.shareViaFacebook=function(d){var e=a.url,f="Magic Camera APP";b.shareViaFacebook(f,d,e).then(function(a){console.log("shareViaFacebook success! :"+a)},function(a){console.log("shareViaFacebook err:"+a),c.showError("Ooops. Something went wrong.")})},d}]),angular.module("sioWebApp.mock",[]).run([function(){}]);